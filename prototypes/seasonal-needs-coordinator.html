<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bana Väg – Seasonal Needs Coordinator</title>
  <style>
    :root { --primary: #7c3aed; --success: #10b981; --bg: #faf5ff; }
    body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #1e293b; }
    .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
    header { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; margin-bottom: 2rem; }
    h1 { font-size: 2.5rem; color: #581c87; margin: 0 0 0.5rem; }
    .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
    .need { border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; background: #f8f5ff; }
    .reserved { background: #fefce8; }
    .fulfilled { background: #f0fdf4; opacity: 0.8; }
    input, textarea, select { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border: 1px solid #cbd5e1; border-radius: 8px; }
    button { padding: 0.75rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #6d28d9; }
    .btn-small { padding: 0.5rem 1rem; font-size: 0.9rem; }
    .btn-green { background: var(--success); }
    .btn-green:hover { background: #059669; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Seasonal Community Coordination</h1>
      <p>Christmas gifts, winter clothing, Ramadan support — coordinate without duplication</p>
    </header>

    <div class="card">
      <h2>Create New Campaign</h2>
      <input id="campaign-name" placeholder="Campaign name (e.g. Christmas 2025 Gift Drive)">
      <input type="date" id="campaign-deadline">
      <input id="campaign-location" placeholder="Drop-off location">
      <textarea id="campaign-desc" rows="2" placeholder="Description (optional)"></textarea>
      <button onclick="createCampaign()">Create Campaign</button>
    </div>

    <h2>Active Campaigns</h2>
    <div id="campaigns"></div>
  </div>

  <script>
    function createCampaign() {
      const name = document.getElementById('campaign-name').value.trim();
      const deadline = document.getElementById('campaign-deadline').value;
      const location = document.getElementById('campaign-location').value.trim();
      if (!name || !deadline) return alert("Name and deadline required");
      const campaign = {
        id: Date.now(),
        name,
        deadline,
        location,
        desc: document.getElementById('campaign-desc').value.trim(),
        needs: [],
        created: new Date().toISOString()
      };
      let campaigns = JSON.parse(localStorage.getItem('banaVagCampaigns') || '[]');
      campaigns.push(campaign);
      localStorage.setItem('banaVagCampaigns', JSON.stringify(campaigns));
      renderCampaigns();
      document.getElementById('campaign-name').value = '';
      document.getElementById('campaign-deadline').value = '';
      document.getElementById('campaign-location').value = '';
      document.getElementById('campaign-desc').value = '';
    }

    function addNeed(campaignId) {
      const item = prompt("Item needed (e.g. Winter jacket size 120)");
      const qty = prompt("Quantity needed", "1");
      const details = prompt("Details (age, gender, etc. – optional)");
      if (!item) return;
      let campaigns = JSON.parse(localStorage.getItem('banaVagCampaigns') || '[]');
      campaigns = campaigns.map(c => {
        if (c.id === campaignId) {
          c.needs.push({
            id: Date.now(),
            item,
            quantity: parseInt(qty) || 1,
            details: details || '',
            reserved: [],
            fulfilled: []
          });
        }
        return c;
      });
      localStorage.setItem('banaVagCampaigns', JSON.stringify(campaigns));
      renderCampaigns();
    }

    function reserve(needId, campaignId) {
      const name = prompt("Your name for coordination:");
      if (!name) return;
      let campaigns = JSON.parse(localStorage.getItem('banaVagCampaigns') || '[]');
      campaigns = campaigns.map(c => {
        if (c.id === campaignId) {
          c.needs = c.needs.map(n => {
            if (n.id === needId && n.reserved.length < n.quantity) {
              n.reserved.push({ name, date: new Date().toISOString() });
            }
            return n;
          });
        }
        return c;
      });
      localStorage.setItem('banaVagCampaigns', JSON.stringify(campaigns));
      renderCampaigns();
    }

    function markFulfilled(needId, resIndex, campaignId) {
      let campaigns = JSON.parse(localStorage.getItem('banaVagCampaigns') || '[]');
      campaigns = campaigns.map(c => {
        if (c.id === campaignId) {
          c.needs = c.needs.map(n => {
            if (n.id === needId) {
              const res = n.reserved.splice(resIndex, 1)[0];
              n.fulfilled.push({ ...res, fulfilledDate: new Date().toISOString() });
            }
            return n;
          });
        }
        return c;
      });
      localStorage.setItem('banaVagCampaigns', JSON.stringify(campaigns));
      renderCampaigns();
    }

    function renderCampaigns() {
      const container = document.getElementById('campaigns');
      let campaigns = JSON.parse(localStorage.getItem('banaVagCampaigns') || '[]');
      if (campaigns.length === 0) {
        container.innerHTML = '<p style="text-align:center;color:#64748b;">No active campaigns. Create one above.</p>';
        return;
      }
      container.innerHTML = campaigns.map(c => {
        const daysLeft = Math.ceil((new Date(c.deadline) - new Date()) / (1000*60*60*24));
        return `
          <div class="card">
            <h3>${c.name}</h3>
            <p><strong>Deadline:</strong> ${new Date(c.deadline).toLocaleDateString()} (${daysLeft > 0 ? daysLeft + ' days left' : 'Overdue'})</p>
            <p><strong>Drop-off:</strong> ${c.location}</p>
            ${c.desc ? `<p>${c.desc}</p>` : ''}
            <button onclick="addNeed(${c.id})">Add Needed Item</button>
            <div class="grid" style="margin-top:1rem;">
              ${c.needs.map(n => {
                const remaining = n.quantity - n.reserved.length - n.fulfilled.length;
                return `
                  <div class="need ${n.reserved.length > 0 ? 'reserved' : ''}">
                    <strong>${n.item}</strong> × ${n.quantity}
                    ${n.details ? `<br><em>${n.details}</em>` : ''}
                    <p><strong>Remaining:</strong> ${remaining}</p>
                    ${n.reserved.map((r, i) => `
                      <div style="background:#fefce8;padding:0.5rem;margin:0.5rem 0;border-radius:4px;">
                        Reserved by ${r.name}
                        <button class="btn-small btn-green" onclick="markFulfilled(${n.id}, ${i}, ${c.id})">Mark received</button>
                      </div>
                    `).join('')}
                    ${n.fulfilled.length > 0 ? `<p><em>${n.fulfilled.length} received</em></p>` : ''}
                    ${remaining > 0 ? `<button onclick="reserve(${n.id}, ${c.id})">Reserve one</button>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    renderCampaigns();
  </script>
</body>
</html>
