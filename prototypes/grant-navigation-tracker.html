<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bana Väg – Grant Navigator</title>
  <style>
    :root { --primary: #059669; --urgent: #dc2626; --bg: #f0fdf4; }
    body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #1e293b; }
    .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
    header { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; margin-bottom: 2rem; }
    h1 { font-size: 2.5rem; color: #065f46; margin: 0 0 0.5rem; }
    .tabs { display: flex; background: white; border-radius: 12px; overflow: hidden; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .tab { flex: 1; padding: 1rem; text-align: center; cursor: pointer; background: #f1f5f9; }
    .tab.active { background: var(--primary); color: white; }
    .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
    .urgent { border-left: 4px solid var(--urgent); }
    input, select, textarea { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border: 1px solid #cbd5e1; border-radius: 8px; }
    button { padding: 0.75rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #047857; }
    .status-pending { background: #fef3c7; color: #92400e; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.875rem; }
    .status-approved { background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.875rem; }
    .status-denied { background: #fee2e2; color: #991b1b; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.875rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Grant Navigator</h1>
      <p>Track available foundation grants and application status (privacy-protected)</p>
    </header>

    <div class="tabs">
      <div class="tab active" onclick="switchView('grants')">Available Grants</div>
      <div class="tab" onclick="switchView('apps')">My Applications</div>
    </div>

    <div id="grants-view">
      <div class="card">
        <h2>Add Known Grant Opportunity</h2>
        <input id="grant-name" placeholder="Grant name">
        <input id="grant-foundation" placeholder="Foundation/Organization">
        <select id="grant-category">
          <option value="">Category</option>
          <option>Emergency Assistance</option>
          <option>Education/Training</option>
          <option>Healthcare</option>
          <option>Housing</option>
          <option>Debt Relief</option>
          <option>Family Support</option>
          <option>Other</option>
        </select>
        <input type="number" id="grant-amount" placeholder="Typical amount (SEK)">
        <input type="date" id="grant-deadline">
        <textarea id="grant-eligibility" rows="3" placeholder="Eligibility criteria"></textarea>
        <input id="grant-link" placeholder="Application link or contact">
        <button onclick="addGrant()">Add Grant</button>
      </div>

      <h2>Current Grant Opportunities</h2>
      <div id="grants-list"></div>
    </div>

    <div id="apps-view" style="display:none;">
      <div class="card">
        <h2>Track New Application</h2>
        <input id="app-ref" placeholder="Reference code or person initials">
        <select id="app-grant">
          <option value="">Select grant</option>
        </select>
        <textarea id="app-notes" rows="2" placeholder="Initial notes"></textarea>
        <button onclick="addApplication()">Start Tracking</button>
      </div>

      <h2>Active Applications</h2>
      <div id="apps-list"></div>
    </div>
  </div>

  <script>
    function switchView(view) {
      document.getElementById('grants-view').style.display = view === 'grants' ? 'block' : 'none';
      document.getElementById('apps-view').style.display = view === 'apps' ? 'block' : 'none';
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.textContent.includes(view === 'grants' ? 'Grants' : 'Applications')));
      if (view === 'apps') populateGrantSelect();
    }

    function addGrant() {
      const grant = {
        id: Date.now(),
        name: document.getElementById('grant-name').value.trim(),
        foundation: document.getElementById('grant-foundation').value.trim(),
        category: document.getElementById('grant-category').value,
        amount: document.getElementById('grant-amount').value,
        deadline: document.getElementById('grant-deadline').value,
        eligibility: document.getElementById('grant-eligibility').value.trim(),
        link: document.getElementById('grant-link').value.trim(),
        posted: new Date().toISOString()
      };
      if (!grant.name || !grant.deadline) return alert("Name and deadline required");
      let grants = JSON.parse(localStorage.getItem('banaVagGrants') || '[]');
      grants.push(grant);
      localStorage.setItem('banaVagGrants', JSON.stringify(grants));
      renderGrants();
    }

    function addApplication() {
      const ref = document.getElementById('app-ref').value.trim();
      const grantId = document.getElementById('app-grant').value;
      if (!ref || !grantId) return alert("Reference and grant required");
      const app = {
        id: Date.now(),
        ref,
        grantId: parseInt(grantId),
        notes: document.getElementById('app-notes').value.trim(),
        status: 'pending',
        submitted: new Date().toISOString()
      };
      let apps = JSON.parse(localStorage.getItem('banaVagApplications') || '[]');
      apps.push(app);
      localStorage.setItem('banaVagApplications', JSON.stringify(apps));
      renderApplications();
    }

    function updateStatus(id, status) {
      const notes = prompt("Notes for status change (optional):");
      let apps = JSON.parse(localStorage.getItem('banaVagApplications') || '[]');
      apps = apps.map(a => a.id === id ? {...a, status, statusNotes: notes, lastUpdated: new Date().toISOString()} : a);
      localStorage.setItem('banaVagApplications', JSON.stringify(apps));
      renderApplications();
    }

    function populateGrantSelect() {
      const select = document.getElementById('app-grant');
      const grants = JSON.parse(localStorage.getItem('banaVagGrants') || '[]');
      select.innerHTML = '<option value="">Select grant</option>' + grants.map(g => 
        `<option value="${g.id}">${g.name} – ${g.foundation}</option>`
      ).join('');
    }

    function renderGrants() {
      const list = document.getElementById('grants-list');
      let grants = JSON.parse(localStorage.getItem('banaVagGrants') || '[]');
      if (grants.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:#64748b;">No grants tracked yet.</p>';
        return;
      }
      const now = new Date();
      list.innerHTML = grants.sort((a,b) => new Date(a.deadline) - new Date(b.deadline)).map(g => {
        const daysLeft = Math.ceil((new Date(g.deadline) - now) / (1000*60*60*24));
        const isUrgent = daysLeft <= 14;
        return `
          <div class="card ${isUrgent ? 'urgent' : ''}">
            <h3>${g.name}</h3>
            <p><strong>Foundation:</strong> ${g.foundation}</p>
            <p><strong>Category:</strong> ${g.category}</p>
            ${g.amount ? `<p><strong>Typical amount:</strong> ${g.amount} SEK</p>` : ''}
            <p><strong>Deadline:</strong> ${new Date(g.deadline).toLocaleDateString()} ${isUrgent ? '<strong style="color:#dc2626"> (URGENT – ' + daysLeft + ' days)</strong>' : ''}</p>
            ${g.eligibility ? `<p><strong>Eligibility:</strong> ${g.eligibility}</p>` : ''}
            ${g.link ? `<p><strong>Contact/Link:</strong> ${g.link}</p>` : ''}
          </div>
        `;
      }).join('');
    }

    function renderApplications() {
      const list = document.getElementById('apps-list');
      let apps = JSON.parse(localStorage.getItem('banaVagApplications') || '[]');
      const grants = JSON.parse(localStorage.getItem('banaVagGrants') || '[]');
      const grantMap = Object.fromEntries(grants.map(g => [g.id, g]));
      if (apps.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:#64748b;">No applications being tracked.</p>';
        return;
      }
      list.innerHTML = apps.map(a => {
        const grant = grantMap[a.grantId] || { name: 'Unknown grant' };
        return `
          <div class="card">
            <h3>Ref: ${a.ref} – ${grant.name}</h3>
            <span class="status-${a.status}">${a.status.toUpperCase()}</span>
            ${a.notes ? `<p><strong>Notes:</strong> ${a.notes}</p>` : ''}
            ${a.statusNotes ? `<p><em>Last update: ${a.statusNotes}</em></p>` : ''}
            <p>Submitted: ${new Date(a.submitted).toLocaleDateString()}</p>
            <button onclick="updateStatus(${a.id}, a.status === 'pending' ? 'submitted' : a.status === 'submitted' ? 'approved' : 'denied')">Update Status →</button>
          </div>
        `;
      }).join('');
    }

    renderGrants();
    renderApplications();
  </script>
</body>
</html>
